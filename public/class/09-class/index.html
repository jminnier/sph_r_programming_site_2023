<!DOCTYPE html>
<html lang="en-us" 
      xmlns:og="http://ogp.me/ns#" 
      xmlns:fb="https://www.facebook.com/2008/fbml">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 4.7.0">

  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Ted Laderas">

  
  
  
    
  
  <meta name="description" content="R Project files Class Video Post-Class Muddiest Points Clearest points   R Project files Please download the part8 sub-folder from this dropbox link. Be sure to unzip if necessary. Knit the part8.Rmd to install any required packages.
 Class Video  View last year‚Äôs class and materials here.
 Post-Class Please fill out the following survey and we will discuss the results during the next lecture. All responses will be anonymous.">

  
  <link rel="alternate" hreflang="en-us" href="https://sph-r-programming-2023.netlify.app/class/09-class/">

  


  
  
  
  <meta name="theme-color" content="#000066">
  

  
  
  
  <script src="/js/mathjax-config.js"></script>
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/github.min.css" crossorigin="anonymous" title="hl-light">
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" disabled>
        
      
    

    

    

    
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.1.2/lazysizes.min.js" integrity="sha256-Md1qLToewPeKjfAHU1zyPwOutccPAm5tahnaw7Osw0A=" crossorigin="anonymous" async></script>
      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js" integrity="" crossorigin="anonymous" async></script>
      
    
      

      
      

      
    

  

  
  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fira+Sans+Condensed:400,400i,700,700i%7COverpass:400,400i,700,700i&display=swap">
  

  
  
  
  
  <link rel="stylesheet" href="/css/academic.css">

  




  


  

  <link rel="manifest" href="/index.webmanifest">
  <link rel="icon" type="image/png" href="/images/icon_hu0b7a4cb9992c9ac0e91bd28ffd38dd00_9727_32x32_fill_lanczos_center_3.png">
  <link rel="apple-touch-icon" type="image/png" href="/images/icon_hu0b7a4cb9992c9ac0e91bd28ffd38dd00_9727_192x192_fill_lanczos_center_3.png">

  <link rel="canonical" href="https://sph-r-programming-2023.netlify.app/class/09-class/">

  
  
  
  
  
    
  
  
  <meta property="twitter:card" content="summary_large_image">
  
  <meta property="twitter:site" content="@datapointier">
  <meta property="twitter:creator" content="@datapointier">
  
  <meta property="og:site_name" content="R Programming 2023">
  <meta property="og:url" content="https://sph-r-programming-2023.netlify.app/class/09-class/">
  <meta property="og:title" content="(Class 9) Part 7 continued and Part 8 . Intro to stats/`broom`/More Purrr | R Programming 2023">
  <meta property="og:description" content="R Project files Class Video Post-Class Muddiest Points Clearest points   R Project files Please download the part8 sub-folder from this dropbox link. Be sure to unzip if necessary. Knit the part8.Rmd to install any required packages.
 Class Video  View last year‚Äôs class and materials here.
 Post-Class Please fill out the following survey and we will discuss the results during the next lecture. All responses will be anonymous."><meta property="og:image" content="https://sph-r-programming-2023.netlify.app/img/social-image.png">
  <meta property="twitter:image" content="https://sph-r-programming-2023.netlify.app/img/social-image.png"><meta property="og:locale" content="en-us">
  
    
      <meta property="article:published_time" content="2023-03-08T00:00:00&#43;00:00">
    
    <meta property="article:modified_time" content="2023-02-28T20:44:41-08:00">
  

  



  


  


  <link rel="shortcut icon" href="https://sph-r-programming-2023.netlify.app/favicon.ico" />
  <link rel="apple-touch-icon-precomposed" sizes="57x57" href="https://sph-r-programming-2023.netlify.app/img/apple-touch-icon-57x57.png" />
  <link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://sph-r-programming-2023.netlify.app/img/apple-touch-icon-114x114.png" />
  <link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://sph-r-programming-2023.netlify.app/img/apple-touch-icon-72x72.png" />
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://sph-r-programming-2023.netlify.app/img/apple-touch-icon-144x144.png" />
  <link rel="apple-touch-icon-precomposed" sizes="120x120" href="https://sph-r-programming-2023.netlify.app/img/apple-touch-icon-120x120.png" />
  <link rel="apple-touch-icon-precomposed" sizes="152x152" href="https://sph-r-programming-2023.netlify.app/img/apple-touch-icon-152x152.png" />
  <link rel="icon" type="image/png" href="https://sph-r-programming-2023.netlify.app/img/favicon-32x32.png" sizes="32x32" />
  <link rel="icon" type="image/png" href="https://sph-r-programming-2023.netlify.app/img/favicon-16x16.png" sizes="16x16" />
  <meta name="application-name" content="BSTA 504: R Programming 2023" />
  <meta name="msapplication-TileColor" content="#FFFFFF" />
  <meta name="msapplication-TileImage" content="https://sph-r-programming-2023.netlify.app/img/mstile-144x144.png" />


  <title>(Class 9) Part 7 continued and Part 8 . Intro to stats/`broom`/More Purrr | R Programming 2023</title>

</head>


<body id="top" data-spy="scroll" data-offset="70"
    data-target="#TableOfContents"
    >

    <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


    







<nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
  <div class="container">

    
    <div class="d-none d-lg-inline-flex">
      <a class="navbar-brand" href="/">R Programming 2023</a>
    </div>
    

    
    <button type="button" class="navbar-toggler" data-toggle="collapse"
            data-target="#navbar-content" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
    <span><i class="fas fa-bars"></i></span>
    </button>
    

    
    <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
      <a class="navbar-brand" href="/">R Programming 2023</a>
    </div>
    

    
    
    <div class="navbar-collapse main-menu-item collapse justify-content-end" id="navbar-content">

      
      <ul class="navbar-nav d-md-inline-flex">
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="/syllabus/"><span>Syllabus</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="/schedule/"><span>Schedule</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="/reading/"><span>Readings</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link  active" href="/class/"><span>Classes</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="/functions/"><span>Functions</span></a>
        </li>

        
        

        

        
        
        
          
            
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="https://sph-r-programming-2023-midterms.netlify.app/" target="_blank" rel="noopener"><span>Midterm Projects</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="/reviews/"><span>Course Reviews</span></a>
        </li>

        
        

      

        
      </ul>
    </div>

    <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">
      

      

      

    </ul>

  </div>
</nav>


    

<div class="container-fluid docs">
    <div class="row flex-xl-nowrap">
        <div class="col-12 col-md-3 col-xl-2 docs-sidebar">
            





  




<form class="docs-search d-flex align-items-center">
  <button class="btn docs-toggle d-md-none p-0 mr-3" type="button" data-toggle="collapse" data-target="#docs-nav" aria-controls="docs-nav" aria-expanded="false" aria-label="Toggle section navigation">
    <span><i class="fas fa-bars"></i></span>
  </button>

  
</form>

<nav class="collapse docs-links" id="docs-nav">
  

  
  
  
  
  <div class="docs-toc-item">
    <a class="docs-toc-link" href="/class/01-class/">Class sessions</a>
    <ul class="nav docs-sidenav">
      
      <li >
        <a href="/class/01-class/">Class 1.  Introduction to R/Rstudio/Vectors</a>
      </li>
      
      <li >
        <a href="/class/02-class/">Part 2: Loading Data, data.frames, and ggplot2</a>
      </li>
      
      <li >
        <a href="/class/03-class/">Part 3: ggplot2, factors, boxplots, dplyr: subsetting</a>
      </li>
      
      <li >
        <a href="/class/04-class/">Part 4. dplyr: mutate, group_by, summarize, across</a>
      </li>
      
      <li >
        <a href="/class/05-class/">(Class 5) Part 4 (contd) &#43; Part 5: Data summarizing</a>
      </li>
      
      <li >
        <a href="/class/06-class/">(Class 6) Part 5 contd: Data summarizing, reshaping, and wrangling with multiple tables (contd)</a>
      </li>
      
      <li >
        <a href="/class/07-class/">(Class 7) Part 6: Messy data example, more data wrangling and ggplot</a>
      </li>
      
      <li >
        <a href="/class/08-class/">(Class 8) Part 6 Continued, Part 7: Lists/Functions/Intro to Purrr</a>
      </li>
      
      <li class="active">
        <a href="/class/09-class/">(Class 9) Part 7 continued and Part 8 . Intro to stats/`broom`/More Purrr</a>
      </li>
      
      <li >
        <a href="/class/10-class/">(Class 10): Part 8 (contd). Intro to stats/`broom`/More Purrr</a>
      </li>
      
      <li >
        <a href="/class/11-class/">Class 11: No Class, Just Office Hours</a>
      </li>
      
    </ul>
    

  </div>
  
  
</nav>

        </div>

        

        <main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 docs-content" role="main">

            <article class="article">

                <div class="docs-article-container">
                    <h1>(Class 9) Part 7 continued and Part 8 . Intro to stats/`broom`/More Purrr</h1>

                    

                    

                    
                    <div class="due-date p-2 mb-3 bg-secondary text-white">
                        Materials from class on Wednesday, March 8, 2023
                    </div>
                    

                    <div class="article-style">
                        

<div id="TOC">
<ul>
<li><a href="#r-project-files" id="toc-r-project-files">R Project files</a></li>
<li><a href="#class-video" id="toc-class-video">Class Video</a></li>
<li><a href="#post-class" id="toc-post-class">Post-Class</a></li>
<li><a href="#muddiest-points" id="toc-muddiest-points">Muddiest Points</a></li>
<li><a href="#clearest-points" id="toc-clearest-points">Clearest points</a></li>
</ul>
</div>

<div id="r-project-files" class="section level2">
<h2>R Project files</h2>
<p>Please download the part8 sub-folder from <a href="https://www.dropbox.com/sh/q4z72523kl84ywp/AAASb1YIFRpxzrjOeq1FVcXua?dl=0">this dropbox link</a>. Be sure to unzip if necessary. Knit the <code>part8.Rmd</code> to install any required packages.</p>
</div>
<div id="class-video" class="section level2">
<h2>Class Video</h2>
<iframe width="560" height="315" src="https://www.youtube.com/embed/X73yjK2zhH4" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen>
</iframe>
<p>View last year‚Äôs class and materials <a href="https://sph-r-programming-2022.netlify.app/class/09-class/">here</a>.</p>
</div>
<div id="post-class" class="section level1">
<h1>Post-Class</h1>
<p>Please fill out the following survey and we will discuss the results during the next lecture. All responses will be anonymous.</p>
<ul>
<li>Clearest Point: What was the most clear part of the lecture?</li>
<li>Muddiest Point: What was the most unclear part of the lecture to you?</li>
<li>Anything Else: Is there something you‚Äôd like me to know?</li>
</ul>
<p><a href="https://bit.ly/bsta504_postclass_survey" class="uri">https://bit.ly/bsta504_postclass_survey</a></p>
</div>
<div id="muddiest-points" class="section level1">
<h1>Muddiest Points</h1>
<p>A lot of things were difficult including ‚Äúthis whole class‚Äù as one person said, and yeah, I get it, it‚Äôs hard stuff! The reason I teach these harder topics like for loops, functions, map, etc, as opposed to just going over more of the same kind of data cleaning tasks with various examples, is because it‚Äôs a lot harder to be motivated to learn the hard stuff if you‚Äôve never been exposed to it. It will probably seem too daunting (I know this because it took me a long time to force myself to learn <code>ggplot</code>, or <code>purrr::map</code>, or even <code>across</code> and the new <code>pivot_longer</code> because I already had other ways of doing that).</p>
<p>You have the tools by now to learn how to do other data cleaning tasks related to what we‚Äôve learned (i.e.¬†more factor and string manipulation, even working with dates will not be that hard to figure out).</p>
<p>Also, part of the reason R is so powerful and useful is that it‚Äôs a ‚Äúreal‚Äù programming language (more similar to C, python, java, etc than SPSS or even SAS or STATA). This part of it will take a lot of practice to feel comfortable if you haven‚Äôt had any programming experience. If you <em>have</em> had programming experience, seeing how it‚Äôs done in R will get you started in the right direction to using the R-specific programming tools like <code>purrr::map</code> that are truly so useful when automating data tasks.</p>
<blockquote>
<p>for loop was a bit confusing when making empty vector</p>
</blockquote>
<p>It really is, and is why I recommend not using for loops but embracing <code>map()</code>! We could get even more technical and talk about how <a href="https://www.r-bloggers.com/2018/08/growing-objects-and-loop-memory-pre-allocation/">it‚Äôs actually better (faster/efficient) to specify the length or dimension of the empty vector (or data frame, or list, or whatever, this is called pre-allocation) because of how memory is allocated in R</a>, but, no, I refuse to go down that rabbit hole and just say, use <code>map()</code>!</p>
<p>Side note: If you‚Äôre working with data with millions of records, you‚Äôll have plenty of speed issues to worry about, and you need an even more advanced R programming class focused on big data.</p>
<blockquote>
<p>I think the whole creation of the function is still quite a bit hazy for me. I believe it‚Äôs something that just takes some more practice. Hoping we can fit some more practice challenges to help really build this understanding.</p>
</blockquote>
<p>We will start class with another function example, but please ask questions about anything confusing about it during class, too!</p>
<blockquote>
<p>I am still struggling with functions! In the reading on functions, I got confused about the difference between the &amp;&amp; || operators and the &amp; | operators..
The reading said ‚Äúbeware of floating point numbers‚Äù and I‚Äôm not sure what that is.</p>
</blockquote>
<p>As we saw in class, the &amp; ‚Äúand‚Äù operator and | ‚Äúor‚Äù operator are logic operators used to string one condition to another, such as:</p>
<pre class="r"><code>thing &lt;- 3
is.na(thing) | thing == 3</code></pre>
<pre><code>## [1] TRUE</code></pre>
<pre class="r"><code>is.na(thing) &amp; thing == 3</code></pre>
<pre><code>## [1] FALSE</code></pre>
<p>But remember we talked about how most functions in R are vectorized, which means they work seamlessly over a vector. This is true for | and &amp; as well. However, if you <em>didn‚Äôt</em> want that vectorized behavior and only wanted to check the first elements of a vector you‚Äôd use the double &amp;&amp; and ||. This becomes useful for if statements, but, you likely don‚Äôt need to worry about it, and you probably want the single &amp; |.</p>
<pre class="r"><code>thing &lt;- 1:3
is.na(thing) | thing == 3</code></pre>
<pre><code>## [1] FALSE FALSE  TRUE</code></pre>
<pre class="r"><code>is.na(thing) &amp; thing == 3</code></pre>
<pre><code>## [1] FALSE FALSE FALSE</code></pre>
<pre class="r"><code>is.na(thing) || thing == 3</code></pre>
<pre><code>## [1] FALSE</code></pre>
<pre class="r"><code>is.na(thing) &amp;&amp; thing == 3</code></pre>
<pre><code>## [1] FALSE</code></pre>
<p>Another very specific situation mentioned in that reading is that floating point numbers (numeric values with lots of numbers after the decimal point) sometimes due to computational rounding/storage will not be <em>exactly</em> equal to each other so you just need to be wary of using <code>==</code> there. The example from the reading sums it up well:</p>
<pre class="r"><code>thing &lt;- sqrt(2)^2 # should be 2, right?
2==thing # huh</code></pre>
<pre><code>## [1] FALSE</code></pre>
<pre class="r"><code>identical(2,thing) # weird</code></pre>
<pre><code>## [1] FALSE</code></pre>
<pre class="r"><code>2 - thing # extremely small value</code></pre>
<pre><code>## [1] -4.440892e-16</code></pre>
<pre class="r"><code># I used to check for &quot;equality&quot; this way...before I knew about dplyr::near()
(2-thing) &lt; 1e-16</code></pre>
<pre><code>## [1] TRUE</code></pre>
<pre class="r"><code>dplyr::near(2,thing)</code></pre>
<pre><code>## [1] TRUE</code></pre>
<blockquote>
<p>Still struggling with the difference between [[]] and [] and unclear on whether that distinction is actually important functionally.</p>
</blockquote>
<p>It is very important functionally, if you think back to your homework question where you got different data types depending on which you use. Sometimes you want a list, sometimes you don‚Äôt want a list. Usually you only want a list ( i.e.¬†<code>list[1:2]</code>) if you are asking for multiple elements of a list, otherwise you‚Äôre wanting to pull out what‚Äôs inside that ‚Äúslot‚Äù and use <code>list[[1]]</code>.</p>
<p>Note that a lot of newer packages make dealing with complex lists less common than it used to be. The example I gave was the <code>broom</code> package <code>tidy()</code> function. In the past, we all learned how to pull out parts of regression output by accessing parts of the list using <code>[[]]</code> and <code>$</code>, just like I showed in class. Probably a lot of your biostats classes still do it this way because that is how your professor learned it. But, now we just need to use <code>broom::tidy()</code> to get a data frame of coefficients, confidence intervals, and p-values.</p>
<blockquote>
<p>If pluck and pull do the same thing, is there any advantage to using one over the other?</p>
</blockquote>
<p>As I mentioned last class, pluck and pull are similar in that they ‚Äúpull out‚Äù elements from lists but they are used differently so there can not be any ‚Äúadvantage‚Äù. <code>pluck</code> is for lists and <code>pull</code> is for data frames (which are also lists, but you can‚Äôt use <code>pull</code> on a non-df list!).</p>
<pre class="r"><code>library(tidyverse)</code></pre>
<pre><code>## ‚îÄ‚îÄ Attaching core tidyverse packages ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ tidyverse 2.0.0 ‚îÄ‚îÄ
## ‚úî dplyr     1.1.0     ‚úî readr     2.1.4
## ‚úî forcats   1.0.0     ‚úî stringr   1.5.0
## ‚úî ggplot2   3.4.1     ‚úî tibble    3.2.0
## ‚úî lubridate 1.9.2     ‚úî tidyr     1.3.0
## ‚úî purrr     1.0.1     
## ‚îÄ‚îÄ Conflicts ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ tidyverse_conflicts() ‚îÄ‚îÄ
## ‚úñ dplyr::filter() masks stats::filter()
## ‚úñ dplyr::lag()    masks stats::lag()
## ‚Ñπ Use the ]8;;http://conflicted.r-lib.org/conflicted package]8;; to force all conflicts to become errors</code></pre>
<pre class="r"><code>library(palmerpenguins)
# try this on your own:
mylist &lt;- list(&quot;a&quot;=1:3, &quot;b&quot; = 2) 
# mylist %&gt;% pull(&quot;a&quot;)
# Error in UseMethod(&quot;pull&quot;) : 
#  no applicable method for &#39;pull&#39; applied to an object of class &quot;list&quot;</code></pre>
<p>If we do have a data frame/tibble and want to ‚Äúpull out‚Äù a column as a vector (<em>not</em> as a data frame), we are also pulling out an element from a list because a data frame is also a list!</p>
<p>Here is how we would use pull and pluck to do the ‚Äúsame thing‚Äù on a data frame:</p>
<pre class="r"><code># remember a tibble is a special kind of data frame, which is a special kind of list
str(penguins)</code></pre>
<pre><code>## tibble [344 √ó 8] (S3: tbl_df/tbl/data.frame)
##  $ species          : Factor w/ 3 levels &quot;Adelie&quot;,&quot;Chinstrap&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##  $ island           : Factor w/ 3 levels &quot;Biscoe&quot;,&quot;Dream&quot;,..: 3 3 3 3 3 3 3 3 3 3 ...
##  $ bill_length_mm   : num [1:344] 39.1 39.5 40.3 NA 36.7 39.3 38.9 39.2 34.1 42 ...
##  $ bill_depth_mm    : num [1:344] 18.7 17.4 18 NA 19.3 20.6 17.8 19.6 18.1 20.2 ...
##  $ flipper_length_mm: int [1:344] 181 186 195 NA 193 190 181 195 193 190 ...
##  $ body_mass_g      : int [1:344] 3750 3800 3250 NA 3450 3650 3625 4675 3475 4250 ...
##  $ sex              : Factor w/ 2 levels &quot;female&quot;,&quot;male&quot;: 2 1 1 NA 1 2 1 2 NA NA ...
##  $ year             : int [1:344] 2007 2007 2007 2007 2007 2007 2007 2007 2007 2007 ...</code></pre>
<pre class="r"><code>class(penguins)</code></pre>
<pre><code>## [1] &quot;tbl_df&quot;     &quot;tbl&quot;        &quot;data.frame&quot;</code></pre>
<pre class="r"><code>typeof(penguins)</code></pre>
<pre><code>## [1] &quot;list&quot;</code></pre>
<pre class="r"><code>s = penguins %&gt;% pull(species)
str(s)</code></pre>
<pre><code>##  Factor w/ 3 levels &quot;Adelie&quot;,&quot;Chinstrap&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...</code></pre>
<pre class="r"><code># does not work because you need quotes for a list element names
# s2 = penguins %&gt;% pluck(species)
# Error in list2(...) : object &#39;species&#39; not found

s2 = penguins %&gt;% pluck(&quot;species&quot;)
str(s2)</code></pre>
<pre><code>##  Factor w/ 3 levels &quot;Adelie&quot;,&quot;Chinstrap&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...</code></pre>
<pre class="r"><code># are they the same?
identical(s, s2)</code></pre>
<pre><code>## [1] TRUE</code></pre>
<p>I am not in the habit of using <code>pluck</code> yet, because I am used to <code>[[]]</code> and use it when I need it. I do use <code>pull</code> all the time to get a vector, though, for example:</p>
<pre class="r"><code>penguins %&gt;% 
  group_by(species) %&gt;%
  summarize(m = mean(bill_length_mm, na.rm = TRUE)) %&gt;%
  pull(m)</code></pre>
<pre><code>## [1] 38.79139 48.83382 47.50488</code></pre>
<p>Or let‚Äôs say I want a list of patient (penguin) ids of a subset:</p>
<pre class="r"><code>mypenguins &lt;- penguins %&gt;%
  mutate(id = row_number(), .before = &quot;species&quot;)

mypenguins %&gt;% 
  filter(bill_length_mm &lt; 35)</code></pre>
<pre><code>## # A tibble: 9 √ó 9
##      id species island    bill_length_mm bill_dept‚Ä¶¬π flipp‚Ä¶¬≤ body_‚Ä¶¬≥ sex    year
##   &lt;int&gt; &lt;fct&gt;   &lt;fct&gt;              &lt;dbl&gt;       &lt;dbl&gt;   &lt;int&gt;   &lt;int&gt; &lt;fct&gt; &lt;int&gt;
## 1     9 Adelie  Torgersen           34.1        18.1     193    3475 &lt;NA&gt;   2007
## 2    15 Adelie  Torgersen           34.6        21.1     198    4400 male   2007
## 3    19 Adelie  Torgersen           34.4        18.4     184    3325 fema‚Ä¶  2007
## 4    55 Adelie  Biscoe              34.5        18.1     187    2900 fema‚Ä¶  2008
## 5    71 Adelie  Torgersen           33.5        19       190    3600 fema‚Ä¶  2008
## 6    81 Adelie  Torgersen           34.6        17.2     189    3200 fema‚Ä¶  2008
## 7    93 Adelie  Dream               34          17.1     185    3400 fema‚Ä¶  2008
## 8    99 Adelie  Dream               33.1        16.1     178    2900 fema‚Ä¶  2008
## 9   143 Adelie  Dream               32.1        15.5     188    3050 fema‚Ä¶  2009
## # ‚Ä¶ with abbreviated variable names ¬π‚Äãbill_depth_mm, ¬≤‚Äãflipper_length_mm,
## #   ¬≥‚Äãbody_mass_g</code></pre>
<pre class="r"><code>ids_short_bill &lt;- mypenguins %&gt;% 
  filter(bill_length_mm &lt; 35) %&gt;% 
  pull(id)</code></pre>
<p>Now I have a vector of IDs that satisfy my bill length requirements.</p>
<pre class="r"><code>ids_short_bill</code></pre>
<pre><code>## [1]   9  15  19  55  71  81  93  99 143</code></pre>
<blockquote>
<p>I just want to check my understanding is correct. The map() is for list and it can be used as itself, but the across() function is only for data frame or tibble and can be used inside the mutate() function. Is that correct? Then, can we use any function inside those map(), and mutate() ?</p>
</blockquote>
<p>I really like this distinction and clarification! Yes to this part</p>
<ul>
<li><code>map()</code> can be used by itself like, <code>list %&gt;% map(.f = length)</code>, applied to a list or vector</li>
<li><code>across()</code> can only be used as a <em>helper function inside</em> <code>mutate</code> or <code>summarize</code> applied to a data frame/tibble</li>
</ul>
<p>Also:</p>
<ul>
<li>inside <code>across()</code> we need to use <em>very specific</em> syntax which is called <a href="https://tidyselect.r-lib.org/reference/language.html"><code>tidyselect</code></a>.</li>
<li>Think of <code>across()</code> and <code>select()</code> as friends, because they use the same language to select columns.</li>
</ul>
<p>But <code>across()</code> is used more like <code>map()</code> in that it takes a ‚Äúwhat‚Äù argument (<code>.cols =</code> tidy select columns for across, <code>.x =</code> a list or vector for map) and ‚Äúfunction‚Äù argument (<code>.fns=</code> for across because multiple functions can be supplied, <code>.f=</code> for map because only <em>one</em> function can be applied)</p>
<pre class="r"><code>library(palmerpenguins)

penguins %&gt;% select(where(is.numeric))</code></pre>
<pre><code>## # A tibble: 344 √ó 5
##    bill_length_mm bill_depth_mm flipper_length_mm body_mass_g  year
##             &lt;dbl&gt;         &lt;dbl&gt;             &lt;int&gt;       &lt;int&gt; &lt;int&gt;
##  1           39.1          18.7               181        3750  2007
##  2           39.5          17.4               186        3800  2007
##  3           40.3          18                 195        3250  2007
##  4           NA            NA                  NA          NA  2007
##  5           36.7          19.3               193        3450  2007
##  6           39.3          20.6               190        3650  2007
##  7           38.9          17.8               181        3625  2007
##  8           39.2          19.6               195        4675  2007
##  9           34.1          18.1               193        3475  2007
## 10           42            20.2               190        4250  2007
## # ‚Ä¶ with 334 more rows</code></pre>
<pre class="r"><code># penguins %&gt;% across(where(is.numeric))
# Error in `across()`:
# ! Must only be used inside data-masking verbs like `mutate()`,
#   `filter()`, and `group_by()`.

# mutate requires a function that returns a vector the same length as the original vector
penguins %&gt;% mutate(across(.cols = where(is.numeric), .f = as.character))</code></pre>
<pre><code>## # A tibble: 344 √ó 8
##    species island    bill_length_mm bill_depth_mm flipper_‚Ä¶¬π body_‚Ä¶¬≤ sex   year 
##    &lt;fct&gt;   &lt;fct&gt;     &lt;chr&gt;          &lt;chr&gt;         &lt;chr&gt;      &lt;chr&gt;   &lt;fct&gt; &lt;chr&gt;
##  1 Adelie  Torgersen 39.1           18.7          181        3750    male  2007 
##  2 Adelie  Torgersen 39.5           17.4          186        3800    fema‚Ä¶ 2007 
##  3 Adelie  Torgersen 40.3           18            195        3250    fema‚Ä¶ 2007 
##  4 Adelie  Torgersen &lt;NA&gt;           &lt;NA&gt;          &lt;NA&gt;       &lt;NA&gt;    &lt;NA&gt;  2007 
##  5 Adelie  Torgersen 36.7           19.3          193        3450    fema‚Ä¶ 2007 
##  6 Adelie  Torgersen 39.3           20.6          190        3650    male  2007 
##  7 Adelie  Torgersen 38.9           17.8          181        3625    fema‚Ä¶ 2007 
##  8 Adelie  Torgersen 39.2           19.6          195        4675    male  2007 
##  9 Adelie  Torgersen 34.1           18.1          193        3475    &lt;NA&gt;  2007 
## 10 Adelie  Torgersen 42             20.2          190        4250    &lt;NA&gt;  2007 
## # ‚Ä¶ with 334 more rows, and abbreviated variable names ¬π‚Äãflipper_length_mm,
## #   ¬≤‚Äãbody_mass_g</code></pre>
<pre class="r"><code># this works but it shouldn&#39;t and is &quot;deprecated&quot; in dplyr 1.1.0
# summarize SHOULD return a vector of length 1
penguins %&gt;% summarize(across(.cols = where(is.numeric), .f = as.character))</code></pre>
<pre><code>## Warning: Returning more (or less) than 1 row per `summarise()` group was deprecated in
## dplyr 1.1.0.
## ‚Ñπ Please use `reframe()` instead.
## ‚Ñπ When switching from `summarise()` to `reframe()`, remember that `reframe()`
##   always returns an ungrouped data frame and adjust accordingly.</code></pre>
<pre><code>## # A tibble: 344 √ó 5
##    bill_length_mm bill_depth_mm flipper_length_mm body_mass_g year 
##    &lt;chr&gt;          &lt;chr&gt;         &lt;chr&gt;             &lt;chr&gt;       &lt;chr&gt;
##  1 39.1           18.7          181               3750        2007 
##  2 39.5           17.4          186               3800        2007 
##  3 40.3           18            195               3250        2007 
##  4 &lt;NA&gt;           &lt;NA&gt;          &lt;NA&gt;              &lt;NA&gt;        2007 
##  5 36.7           19.3          193               3450        2007 
##  6 39.3           20.6          190               3650        2007 
##  7 38.9           17.8          181               3625        2007 
##  8 39.2           19.6          195               4675        2007 
##  9 34.1           18.1          193               3475        2007 
## 10 42             20.2          190               4250        2007 
## # ‚Ä¶ with 334 more rows</code></pre>
<pre class="r"><code>penguins %&gt;% summarize(across(.cols = where(is.numeric), .f = length))</code></pre>
<pre><code>## # A tibble: 1 √ó 5
##   bill_length_mm bill_depth_mm flipper_length_mm body_mass_g  year
##            &lt;int&gt;         &lt;int&gt;             &lt;int&gt;       &lt;int&gt; &lt;int&gt;
## 1            344           344               344         344   344</code></pre>
<pre class="r"><code>mylist &lt;- list(&quot;a&quot;=1:3, &quot;b&quot; = 2, c = penguins) 

# .x can be piped into map or used as an explicit argument
mylist %&gt;% map(.f = length)</code></pre>
<pre><code>## $a
## [1] 3
## 
## $b
## [1] 1
## 
## $c
## [1] 8</code></pre>
<pre class="r"><code>map(.x = mylist, .f = length)</code></pre>
<pre><code>## $a
## [1] 3
## 
## $b
## [1] 1
## 
## $c
## [1] 8</code></pre>
<pre class="r"><code># this also works because penguins is a data frame which means it is also a list (columns are elements)
penguins %&gt;% map(.f = length)</code></pre>
<pre><code>## $species
## [1] 344
## 
## $island
## [1] 344
## 
## $bill_length_mm
## [1] 344
## 
## $bill_depth_mm
## [1] 344
## 
## $flipper_length_mm
## [1] 344
## 
## $body_mass_g
## [1] 344
## 
## $sex
## [1] 344
## 
## $year
## [1] 344</code></pre>
<pre class="r"><code>map(.x = penguins, .f = length)</code></pre>
<pre><code>## $species
## [1] 344
## 
## $island
## [1] 344
## 
## $bill_length_mm
## [1] 344
## 
## $bill_depth_mm
## [1] 344
## 
## $flipper_length_mm
## [1] 344
## 
## $body_mass_g
## [1] 344
## 
## $sex
## [1] 344
## 
## $year
## [1] 344</code></pre>
<p>However, as we will see in class today, we also can use <code>map()</code> inside <code>mutate()</code> when we are using nested data frames, or when we need to ‚Äúvectorize‚Äù a non-vectorized function. In this case, <code>map()</code> is being applied to a list of data that is inside a column of a data frame‚Ä¶.it‚Äôs complicated, and we‚Äôll see more today.</p>
</div>
<div id="clearest-points" class="section level1">
<h1>Clearest points</h1>
<p>For every topic in the muddy list it was also in the clear list, so at least it‚Äôs not all lost. I think more practice will help.</p>
</div>

                    </div>

                    



                    
                </div>

                <div class="body-footer">
                    <p>Last updated on February 28, 2023</p>

                    





  
  

<p class="edit-page">
  <a href="https://github.com/jminnier/sph_r_programming_site/edit/master/content/class/09-class.html">
    <i class="fas fa-pen pr-2"></i>Edit this page
  </a>
</p>




                    

                </div>

            </article>

            <footer>
    <hr>

    <div class="row course-info">
        <div class="col-md-7">
            <p>
                <strong>BSTA 504: R Programming 2023 (Winter 2023)</strong><br>

                <a href="https://www.ohsu.edu" target="_blank" rel="noopener">Oregon Health &amp; Science University / Portland State University</a> &emsp;&emsp;
                <a href="https://ohsu-psu-sph.org/" target="_blank" rel="noopener">OHSU/PSU School of Public Health</a>
            </p>

            <p>
                <a href="http://jessicaminnier.com" target="_blank" rel="noopener"><i class="fas fa-user"></i>
                    Dr. Jessica Minnier</a> &emsp;&emsp;
                <a href="mailto:minnier@ohsu.edu"><i class="fas fa-envelope"></i>
                    minnier@ohsu.edu</a>
            </p>

            <p>
                <i class="far fa-calendar-alt"></i> Wednesdays &emsp;&emsp;
                <i class="far fa-clock"></i> 3:15‚Äì6:05 PM <br>
                <i class="fas fa-university"></i> See Sakai
            </p>
        </div>

        <div class="col-md-5 credits">
            <p><a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png" /></a><br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.</p>
            
            <p>Content <i class="fab fa-creative-commons"></i> 2023 <a href="http://jessicaminnier.com" target="_blank" rel="noopener">ted &amp; jessica</a></p>
        
            <p>This site created with the <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> adapted by <a href="https://github.com/laderast/sph_r_programming_site" target="_blank" rel="noopener">Ted Laderas</a> and <a href="https://github.com/andrewheiss/evalsp20.classes.andrewheiss.com" target="_blank" rel="noopener">Andrew Heiss</a> in <a href="https://bookdown.org/yihui/blogdown/" target="_blank" rel="noopener">blogdown</a> and <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a>. </p>
            
            <p><a href="https://github.com/jminnier/sph_r_programming_site" target="_blank" rel="noopener"><i class="fab fa-github"></i> View the source at GitHub.</a></p>
        </div>
    </div>
</footer>


        </main>
    </div>
</div>

        

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>

      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/highlight.min.js" integrity="sha256-1zu+3BnLYV9LdiY85uXMzii3bdrkelyp37e0ZyTAQh0=" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/r.min.js"></script>
        
      

    

    
    

    
    
    <script>const code_highlighting = true;</script>
    

    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.1/anchor.min.js" integrity="sha256-pB/deHc9CGfFpJRjC43imB29Rse8tak+5eXqntO94ck=" crossorigin="anonymous"></script>
    <script>
      anchors.add();
    </script>
    

    

    
    

    
    

    
    

    
    
    
    
    
    
    
    
    
    
    
    
    <script src="/js/academic.min.a1c3596268a997890f5b9089b30365c6.js"></script>

    






    
    

    
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

</body>

</html>
