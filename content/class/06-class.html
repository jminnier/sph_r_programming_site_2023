---
title: "(Class 6) Part 5 contd: Data summarizing, reshaping, and wrangling with multiple tables (contd)"
linktitle: "(Class 6) Part 5 contd: Data summarizing, reshaping, and wrangling with multiple tables (contd)"
date: "2023-02-15"
class_date: "2023-02-15"
output:
  blogdown::html_page:
    toc: true
menu:
  class:
    parent: Class sessions
    weight: 6
type: docs
weight: 6
# pdf: 
# thumb: 
editor_options: 
  chunk_output_type: console
---


<div id="TOC">
<ul>
<li><a href="#r-project-files" id="toc-r-project-files">R Project files</a></li>
<li><a href="#this-years-class-video" id="toc-this-years-class-video">This yearâ€™s class video</a></li>
<li><a href="#last-years-class-video-part-5-continued-split-about-the-same" id="toc-last-years-class-video-part-5-continued-split-about-the-same">Last Yearâ€™s Class Video (Part 5 continued, split about the same)</a></li>
<li><a href="#post-class" id="toc-post-class">Post-Class</a></li>
<li><a href="#muddiest-points" id="toc-muddiest-points">Muddiest Points</a>
<ul>
<li><a href="#when-do-we-use-which-join" id="toc-when-do-we-use-which-join">When do we use which join?</a></li>
<li><a href="#other-piping-troubles" id="toc-other-piping-troubles">Other: piping troubles</a></li>
</ul></li>
</ul>
</div>

<div id="r-project-files" class="section level2">
<h2>R Project files</h2>
<p>In this class we will finish the part5 material from <a href="https://bit.ly/bsta504_dropbox_2023">this folder link</a>. There are a couple updates so please download <code>part5_updated.Rmd</code> and <code>part5_haven.Rmd</code>.</p>
</div>
<div id="this-years-class-video" class="section level2">
<h2>This yearâ€™s class video</h2>
<p>See Slack for the zoom recording link (though zoom had some malfunction that failed to show the correct Rstudio screen, so last yearâ€™s video may be more helpful)</p>
</div>
<div id="last-years-class-video-part-5-continued-split-about-the-same" class="section level2">
<h2>Last Yearâ€™s Class Video (Part 5 continued, split about the same)</h2>
<iframe width="560" height="315" src="https://www.youtube.com/embed/c3ZuPANIEAM" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen>
</iframe>
<p>View last yearâ€™s class and materials <a href="https://sph-r-programming-2022.netlify.app/class/06-class/">here</a>.</p>
</div>
<div id="post-class" class="section level1">
<h1>Post-Class</h1>
<p>Please fill out the following survey and we will discuss the results during the next lecture. All responses will be anonymous.</p>
<ul>
<li>Clearest Point: What was the most clear part of the lecture?</li>
<li>Muddiest Point: What was the most unclear part of the lecture to you?</li>
<li>Anything Else: Is there something youâ€™d like me to know?</li>
</ul>
<p><a href="https://bit.ly/bsta504_postclass_survey" class="uri">https://bit.ly/bsta504_postclass_survey</a></p>
</div>
<div id="muddiest-points" class="section level1">
<h1>Muddiest Points</h1>
<p>Somewhat equal numbers said that pivot/joining were clear or were muddy! I think that sounds about right, though, these concepts are tricky and will take a lot of practice. Todayâ€™s class will use these methods again and I hope that will help solidify what youâ€™ve learned.</p>
<p>I really do recommend watching the short video that I recommended last class if youâ€™re still having trouble with grasping pivoting.</p>
<p><a href="https://youtu.be/4ZIFb1BoIB4">Dr.Â Kelly Bodwinâ€™s Reshaping Data Video</a></p>
<p>For a short version, watch the <a href="https://youtu.be/4ZIFb1BoIB4?t=365">pivot_longer excerpt</a> about â€œworking backwardsâ€ from a plot. Then watch the <a href="https://youtu.be/4ZIFb1BoIB4?t=620">pivot_wider excerpt</a></p>
<p><a href="https://stat545.com/join-cheatsheet.html">Also read this join cheatsheet</a> for some good explanations/examples about which join to use when!</p>
<p><a href="https://nyu-cdsc.github.io/learningr/assets/data-transformation.pdf">The rstudio cheatsheet is also good.</a></p>
<p>Definitely do the readings in the R for Data Science in the appropriate chapters as well! <a href="https://r4ds.had.co.nz/relational-data.html">joining</a>, <a href="https://r4ds.had.co.nz/tidy-data.html?#pivoting">pivoting</a></p>
<p>For the different join types, here are some visuals I find helpful.</p>
<p>When we use <code>bind_rows()</code> we stack cases on top of each other like so:</p>
<p><img src="/img/bind_rows_add.png" alt=""  width="70%" height="40%"/></p>
<p>For joins, we put columns next to each other based on matching keys. The â€œintersectionâ€ of keys is shown in these diagrams for each type of join, with the blue denoting which keys/rows we keep from which table:</p>
<p><img src="/img/dplyr_join_venn.png" alt=""  width="70%" height="70%"/></p>
<p>A more data oriented visual is shown below. The lines denote the keys that match:</p>
<p><img src="/img/joins_colors.png" alt=""  /></p>
<p>This is from the part5 Rmd:</p>
<div id="when-do-we-use-which-join" class="section level3">
<h3>When do we use which join?</h3>
<p>See this <a href="https://dplyr.tidyverse.org/articles/two-table.html">two-table verbs vignette</a> and this <a href="https://stat545.com/join-cheatsheet.html">cheatsheet</a> for some extra explanations.</p>
<p>These joins are created to match SQL joins for databases.</p>
<ul>
<li><code>inner_join</code> = You only want data that is in both tables</li>
<li><code>left_join</code> = You only want data that is in one table.
<ul>
<li>Often the right table is a subset of the left table, so itâ€™s easy to use this to keep everything in the bigger table, and join on the smaller table</li>
<li>If the left table contains a cohort of interest, i.e.Â everyone that has been given a specific treatment, and you want to get their lab values from another table, use <code>left_join()</code> to add those lab values in the cohort defined by the left table</li>
</ul></li>
<li><code>right_join</code> = maybe never
<ul>
<li><code>right_join</code> does the same thing as <code>left_join</code> but backwards, I find left join easier to think about (personal preference)</li>
</ul></li>
<li><code>full_join</code> = does not remove any rows, you might want to use this as your default and filter later</li>
<li><code>anti_join</code> and <code>semi_join</code> = filtering joins, probably use rarely, use right table as an exclusion criteria and find unmatched keys between two tables (<code>anti_join</code>), or filter left table based on keys in right table (<code>semi_join</code>), and keep only columns from left table</li>
</ul>
<blockquote>
<p>separate(), needed a few more minutes to get it figured out</p>
</blockquote>
<p>Letâ€™s do another short example!</p>
<pre class="r"><code>library(tidyverse)</code></pre>
<pre><code>## â”€â”€ Attaching packages â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ tidyverse 1.3.2 â”€â”€
## âœ” ggplot2 3.3.6     âœ” purrr   0.3.4
## âœ” tibble  3.1.8     âœ” dplyr   1.1.0
## âœ” tidyr   1.2.0     âœ” stringr 1.4.0
## âœ” readr   2.1.2     âœ” forcats 0.5.1
## â”€â”€ Conflicts â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ tidyverse_conflicts() â”€â”€
## âœ– dplyr::filter() masks stats::filter()
## âœ– dplyr::lag()    masks stats::lag()</code></pre>
<pre class="r"><code>mydata &lt;- tibble(
  name = c(&quot;Doe, Jane&quot;, &quot;Smith, M&quot;, &quot;Lee, Dave&quot;),
  rx = c(&quot;Advil; 4.5 mg&quot;, &quot;Tylenol; 300mg&quot;, &quot;Advil; 2.5 mg&quot;)
)

# obviously the dosage makes no sense, but, for sake of example
mydata</code></pre>
<pre><code>## # A tibble: 3 Ã— 2
##   name      rx            
##   &lt;chr&gt;     &lt;chr&gt;         
## 1 Doe, Jane Advil; 4.5 mg 
## 2 Smith, M  Tylenol; 300mg
## 3 Lee, Dave Advil; 2.5 mg</code></pre>
<pre class="r"><code># by default, separates using most special/non-alphanumeric characters
mydata %&gt;%
  separate(name, into = c(&quot;last_name&quot;, &quot;first_name&quot;))</code></pre>
<pre><code>## # A tibble: 3 Ã— 3
##   last_name first_name rx            
##   &lt;chr&gt;     &lt;chr&gt;      &lt;chr&gt;         
## 1 Doe       Jane       Advil; 4.5 mg 
## 2 Smith     M          Tylenol; 300mg
## 3 Lee       Dave       Advil; 2.5 mg</code></pre>
<pre class="r"><code># since there are special characters in rx, will need to be more specific
# note it tried to split on the . since we only have 2 columns named, it removed the rest
mydata %&gt;%
  separate(rx, into = c(&quot;rx_name&quot;, &quot;rx_dose&quot;))</code></pre>
<pre><code>## Warning: Expected 2 pieces. Additional pieces discarded in 2 rows [1, 3].</code></pre>
<pre><code>## # A tibble: 3 Ã— 3
##   name      rx_name rx_dose
##   &lt;chr&gt;     &lt;chr&gt;   &lt;chr&gt;  
## 1 Doe, Jane Advil   4      
## 2 Smith, M  Tylenol 300mg  
## 3 Lee, Dave Advil   2</code></pre>
<pre class="r"><code># if we add in some more columns, we can see it&#39;s splitting based on ; . and space!
mydata %&gt;%
  separate(rx, into = c(&quot;rx_name&quot;, &quot;rx_dose&quot;, &quot;a&quot;, &quot;b&quot;, &quot;c&quot;))</code></pre>
<pre><code>## Warning: Expected 5 pieces. Missing pieces filled with `NA` in 3 rows [1, 2, 3].</code></pre>
<pre><code>## # A tibble: 3 Ã— 6
##   name      rx_name rx_dose a     b     c    
##   &lt;chr&gt;     &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;
## 1 Doe, Jane Advil   4       5     mg    &lt;NA&gt; 
## 2 Smith, M  Tylenol 300mg   &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; 
## 3 Lee, Dave Advil   2       5     mg    &lt;NA&gt;</code></pre>
<pre class="r"><code># still have a space
mydata %&gt;%
  separate(rx, into = c(&quot;rx_name&quot;, &quot;rx_dose&quot;), sep=&quot;;&quot;)</code></pre>
<pre><code>## # A tibble: 3 Ã— 3
##   name      rx_name rx_dose  
##   &lt;chr&gt;     &lt;chr&gt;   &lt;chr&gt;    
## 1 Doe, Jane Advil   &quot; 4.5 mg&quot;
## 2 Smith, M  Tylenol &quot; 300mg&quot; 
## 3 Lee, Dave Advil   &quot; 2.5 mg&quot;</code></pre>
<pre class="r"><code># removed the space
mydata %&gt;%
  separate(rx, into = c(&quot;rx_name&quot;, &quot;rx_dose&quot;), sep=&quot;; &quot;)</code></pre>
<pre><code>## # A tibble: 3 Ã— 3
##   name      rx_name rx_dose
##   &lt;chr&gt;     &lt;chr&gt;   &lt;chr&gt;  
## 1 Doe, Jane Advil   4.5 mg 
## 2 Smith, M  Tylenol 300mg  
## 3 Lee, Dave Advil   2.5 mg</code></pre>
<pre class="r"><code># removed the space, let&#39;s also remove the mg
mydata %&gt;%
  separate(rx, into = c(&quot;rx_name&quot;, &quot;rx_dose_mg&quot;), sep=&quot;; &quot;) %&gt;%
  mutate(rx_dose_mg = str_remove_all(rx_dose_mg, &quot;mg&quot;),
         rx_dose_mg = as.numeric(rx_dose_mg))</code></pre>
<pre><code>## # A tibble: 3 Ã— 3
##   name      rx_name rx_dose_mg
##   &lt;chr&gt;     &lt;chr&gt;        &lt;dbl&gt;
## 1 Doe, Jane Advil          4.5
## 2 Smith, M  Tylenol      300  
## 3 Lee, Dave Advil          2.5</code></pre>
<pre class="r"><code># all together, and also leave the name column in
mydata %&gt;%
  separate(name, into = c(&quot;last_name&quot;, &quot;first_name&quot;), remove = FALSE) %&gt;%
  separate(rx, into = c(&quot;rx_name&quot;, &quot;rx_dose_mg&quot;), sep=&quot;; &quot;) %&gt;%
  mutate(rx_dose_mg = str_remove_all(rx_dose_mg, &quot;mg&quot;),
         rx_dose_mg = as.numeric(rx_dose_mg))</code></pre>
<pre><code>## # A tibble: 3 Ã— 5
##   name      last_name first_name rx_name rx_dose_mg
##   &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;      &lt;chr&gt;        &lt;dbl&gt;
## 1 Doe, Jane Doe       Jane       Advil          4.5
## 2 Smith, M  Smith     M          Tylenol      300  
## 3 Lee, Dave Lee       Dave       Advil          2.5</code></pre>
</div>
<div id="other-piping-troubles" class="section level2">
<h2>Other: piping troubles</h2>
<blockquote>
<p>I have issues with my pipes where I think Iâ€™m putting things in the wrong order and nothing happens- I donâ€™t get errors I can google, it just doesnâ€™t work. Most often itâ€™s when I end a pipe with %&gt;% tabyl(variable), maybe that is a no-no? But Iâ€™ve found I end up having to break pipes into multiple pieces because I canâ€™t string them together the right way.</p>
</blockquote>
<blockquote>
<p>I have a hard time understanding when to pipe things together or knowing when to nest a function as well. Iâ€™m glad youâ€™ve reassured us in class that itâ€™s ok that we put our functions into pieces. I think that eases the stress with learning as I feel like trying to make everything happen in one command can be very overwhelming.</p>
</blockquote>
<p>Yes, yes! Please separate out your pipes/commands if it makes things more clear or makes it work better for you!</p>
<p>Iâ€™m not sure whatâ€™s happening with the no-errors-broken situation. I will say that I often separate the <code>taybl(variable)</code> code when Iâ€™m doing analysis work, just because I am saving intermediate data sets after data cleaning or sub-setting and donâ€™t want to save that tabyl. Something like this:</p>
<pre class="r"><code>library(janitor)</code></pre>
<pre><code>## 
## Attaching package: &#39;janitor&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:stats&#39;:
## 
##     chisq.test, fisher.test</code></pre>
<pre class="r"><code>mtcars6 &lt;- mtcars %&gt;% filter(cyl==6)
# check that it worked
mtcars6 %&gt;% tabyl(cyl)</code></pre>
<pre><code>## Warning: Using one column matrices in `filter()` was deprecated in dplyr 1.1.0.
## â„¹ Please use one dimensional logical vectors instead.
## â„¹ The deprecated feature was likely used in the dplyr package.
##   Please report the issue at &lt;]8;;https://github.com/tidyverse/dplyr/issueshttps://github.com/tidyverse/dplyr/issues]8;;&gt;.</code></pre>
<pre><code>##  cyl n percent
##    6 7       1</code></pre>
<p>As a beginner I definitely think doing each step individually and seeing the result and (saving it/assigning it appropriately!) is the way to learn what each function does. I tend to string things together because I am used to doing that, but Iâ€™ll try not to do that so much if itâ€™s adding confusion.</p>
</div>
</div>
